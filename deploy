# /bin/bash

./gradlew build

tmp_dir=$(mktemp -d)

echo "Unzipping files to $tmp_dir"

unzip -qq build/distributions/*.zip -d $tmp_dir

# Move bin and lib top level
mv $tmp_dir/spiritz*/* $tmp_dir/

# Remove all of the wedding zip folder
rm -rf $temp_dir/spiritz*

echo "Moving Dockerfile"

cp Dockerfile $tmp_dir/

echo "Moving Production.yaml"

cp config/production.yaml $tmp_dir/

current_directory=$(pwd)

cd $tmp_dir/

zip -qqr "./release_$1.zip" bin lib Dockerfile production.yaml

cd $current_directory

mv $tmp_dir/release_$1.zip ./releases/

echo "Created Release $1"

rm -rf $tmp_dir
